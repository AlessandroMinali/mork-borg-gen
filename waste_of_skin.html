<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Waste of Skin - Classes MÖRK BORG Character Generator</title>
  <meta name="description" content="Waste of Skin - Classes MÖRK BORG Character Generator">
  <style type="text/css">
    body { font-family: sans-serif; font-size: 14px }
    .smaller { font-size: 85%; }
    ul { padding-left: 15px }
    div > b:first-child { font-size: 120% }
  </style>
</head>

<body>
  <div id="klass">
    PICK YOUR CLASS:
    <button id="ws" value="0">Wretch (no class)</button>
    <button id="fd" value="1">Fanged Deserter</button>
    <button id="gs" value="2">Guttborn Scum</button>
    <button id="eh" value="3">Esoteric Hermit</button>
    <button id="wr" value="4">Wretched Royalty</button>
    <button id="he" value="5">Heretical Priest</button>
    <button id="oh" value="6">Occult Herbmaster</button>
  </div>
  <div id=prompt style="display: none;">
    Which abilities would you like to try and excel with (select 2):
    <form>
      <input type="checkbox" id="agi" name="agility" value=0>
      <label for="agi"><b>AGILITY</b> <span class="smaller">Defend, balance, swim, flee</span></label><br>
      <input type="checkbox" id="pre" name="presence" value=1>
      <label for="pre"><b>PRESENCE</b> <span class="smaller">Perceive, aim, charm, wield Powers</span></label><br>
      <input type="checkbox" id="str" name="strength" value=2>
      <label for="str"><b>STRENGTH</b> <span class="smaller">Crush, lift, strike, grapple</span></label><br>
      <input type="checkbox" id="tou" name="toughness" value=3>
      <label for="tou"><b>TOUGHNESS</b> <span class="smaller">Resist poison/cold/heat, survive falling</span></label><br>
      <input type="submit" value="Spawn">
    </form>
  </div>
  <div id=character>
    <button id="save">Copy</button>
    <br>
    <br>
    <div style="display: inline-block; padding-right: 20px;"><b style="background: black; color: white;">NAME</b> <span id="name"></span></div>
    <div style="display: inline-block; padding-right: 20px;"><b style="background: black; color: white;">CLASS</b> <span id="class_name"></span></div>
    <div style="display: inline-block; padding-right: 20px;"><b style="background: black; color: white;">HP</b> <span id="hp"></span></div>
    <div style="display: inline-block; padding-right: 20px;"><b style="background: black; color: white;">OMENS</b> <span id="omens"></span></div>
    <br><br>
    <div id="ablities"><b style="background: black; color: white;">ABILITIES</b></div>
    <div><em>AGILITY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</em><span id="agility"></span></div>
    <div><em>PRESENCE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</em><span id="presence"></span></div>
    <div><em>STRENGTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</em><span id="strength"></span></div>
    <div><em>TOUGHNESS&nbsp;&nbsp;&nbsp;&nbsp;</em><span id="toughness"></span></div>
    <br>
    <div style="display: inline-block; width: 500px;"><b style="background: black; color: white;">CLASS SKILLS</b><div id="skills" style="padding: 0px 20px 0px  0px;"></div></div>
    <div style="display: inline-block; width: 500px; vertical-align: top;"><b style="background: black; color: white;">EQUIPMENT</b>
      <ul id="equipment">
      </ul>
    </div>
    <hr>
    <div id="description" style="width: 500px"></div>
  </div>
  <script src="utils.js"></script>
  <script>
    var klass;
    var selected;
    var descriptions = ["Of unkown origins.", "You have thirty or so friends who never let you down: YOUR TEETH. Disloyal, deranged or simply uncontrollable, any group that didn’t boot you out you left anyway. But your parliament of teeth—enormous, protruding, thick and sharp—have always been your allies.", "An ill star smiled upon your birth. Poverty, crime and bad parenting didn’t help either. In your community an honest day’s work was never an option. Not that you ever tried, what are you, some kind of mug? A razor blade and a moonless night are worth a week of chump-work.", "The stone of your cave is one with the stars. Silence and perfection. Now the chaos of a fallen world disturbs your rituals and the caul of night grows blacker than your cavern’s gloom. Irritating!", "Bowed down only by the memories of your own lost glory, you could never submit to anyone else. Not you, of noble blood! (Not that you expect these peons to understand the depths of your sorrow.)", "Hunted by the Two-Headed Basilisks of the One True Faith, this heretic can be found raving in ruins, traipsing endlessly down dusty roads and desecrating cathedrals by night.", "Born of the mushroom, raised in the glade, watched by the eye of the moon in a silverblack pool."]
    var occult_herbmaster_memory = ["calm isolation in the Sarkash dark.", "calm isolation in the Sarkash dark.", "calm isolation in the Sarkash dark.", "the illegal midnight markets of Schleswig", "the heretic isle of Crëlut,two nautical miles east of Grift.", "the old frozen ruins not far from Alliáns.", "a little witches cottage in Galgenbeck.", "the ruins of the Shadow King's manse, thick with memories of mushrooms and smoke."]
    var occult_herbmaster_abilities = [
      ["Tough as Wood", ""],
      ["Low in Protein", ""],
      ["Portable Laboratory", "You carry a portable laboratory and continually search for frequently expended ingredients. Daily you have the materials to create two randomly determined decoctions and can brew a total of d4 doses. If unused they lose vitality after 24 hours."],
      ["List of Decoctions", "<ol><li><b>Red Poison</b> TOUGHNESS DR12 or -d10 HP.</li><li><b>Ezumiel's Vapor</b> Pass a DR14 test or severe hallucinations for d4 hours.</li><li><b>Southern Frog Stew</b> Vomit for d4 hours, pass a DR14 test or you can do nothing else.</li><li><b>Elixir Vitalis</b> Heals d6 HP and stops infection. Can be habit-forming.</li><li><b>Spider-Owl Soup</b> See in darkness, climb on walls for 30 minutes.</li><li><b>Fernor’s Philtre</b> Translucent oil, must be dabbed right into the eye. Heals infection and gives +2 on Presence tests for d4 hours.</li><li><b>Hyphos’ Enervating Snuff</b> Berserk! Two attacks per round but defend with DR14. Lasts one fight. Must be snorted, causes sneezing.</li><li><b>Black Poison Toughness DR14 or -d6 HP and blinded for one hour.</li></ul>"]
    ]
    var heretical_priest_memory = ["Galgenbeck, near the cathedral of the Two-Headed Basilisks.", "a massacred Alliáns cult, sole survivor.", "the crypts of Grift.", "temple ruins in the Valley of the Unfortunate Undead.", "one of the many Graven-Tosk thief-tunnels.", "a secret Bergen Chrypt church."]
    var heretical_priest_abilities = [
      ["Insightful", ""],
      ["Frail", "May use Powers while wearing medium armor"]
    ]
    var heretical_priest_features = [
      ["Sacred Sheperd's Crook", "Its head a hook of human bone inscribed with overlapping anti-prayers. This crook hooks through other worlds. Staff does 2d4 damage except to faithless humans."],
      ["Stolen Mitre", "While wearing this holy hat the priest's vile body fades, becoming hard to hit in combat (Defence DR10). If pulled over the ears outside of battle the priest becomes nearly invisible, testing stealth against DR8."],
      ["List of Sins", "A long and accurate document cross-referenced against the reality to discover unseen evil-doers. Successful PRESENCE DR10: A strange light surronds evil creatures. The list's owner defends with +2 against any being discovered this way."],
      ["The Blasphemous Nechrubel Bible", "So intensely blasphemous even the Priests themselves can only peruse it once per day. When read, roll a die. Even result: For the rest of the day PCs headl d4 HP after just five minutes of rest. Odd result: The priest is plagued by demonic hallucinations. The DM may invent d3 things that only the Priest can see and describe them to the player as if true. This effect end with sunrise."],
      ["Stones Taken from the Thel-Emas' Lost Temple", "Cast the stones on the ground. Their pattern reveals if danger lurks in an adjacent room. The stones can lie. The priest test PRESENCE DR10 to see if they are true but after failing they cannot test again until the sun has set."],
      ["(ʍɹouƃ ɾǝsns) Crucifix", "The crucifix can be used in encounters with the undead as well as lesser trolls and goblins. Check morale (add or subtract the priest's PRESENCE modifier) to see if the creatures bow and kindly remove themselves."]
    ]
    var wretched_royalty_memory = ["your Wästland palace was reduced to rubble.", "your caravan kingdom of Tveland fell into penury.", "King Fathmu IX’s brother Zigmund, your father, was murdered.", "the southern empire of Südglans sank into the sea.", "Anthelia demanded a gift of noble blood.", "two young princes were kidnapped west of Bergen Chrypt and disappeared into the black crevasse of the eastern slopes."]
    var wretched_royalty_abilities = [
      ["Painfully Average", ""]
    ]
    var wretched_royalty_features = [
      ["The Blade of your Ancestors", "This magnificent and clearly magical talking sword is foppish, unreliable and quietly despises you. It taunts your failures and, if continually disappointed, develops a 1-in-6 chance to 'accidentally' attack you or your companions. Deals d6+1 damage. Attack/Defence DR10."],
      ["'Poltroon' the Court Jester", "While pratically useless, personally irritating and an emotional drain, Poltroon's capering actually makes enemies lose their focus in combat. For the first two rounds you and your allies get +2 on Attack/Defence."],
      ["Barbarister the Incredible Horse", "Barbarister is magical, intelligent, arrogant and vain. He can also talk. If you can persuade him to care, Barbarister occaionally adds +2 to PRESENCE tests involving logic and intellect. The horse may be smarter than you and is quite aware of this."],
      ["Hamfund the Squire", "This intensely cowardly servant acts only as guardian for the scabbard of the cursed sword Eurekia. Once per combat, if Ham can be found, Eurekia may be drawn. The sword does 2d6 damage, and for every swing of Eurekia roll a d6. On a 1 the squire is slain and eurekia vanishes forever."],
      ["The Snake-skin Gift", "An expensive sandalwood box bound in snakeskin. It contains a seemingly ordinary dagger, wrapped in silk. The dagger does d4 damage but on a 1 the target dies immediately of deadly poison weeping from the balde."],
      [" Horn of the Schleswig Lords!", "Once per day release a blare from this dented old trumpet and test PRESENCE DR12. One creature may make their next non-combat test an automatic success."]
    ]
    var esoteric_hermit_memory = ["were awakening, adult, in a ritual circle underneath the northen bridge to Grift.", "wandered, memoryless, from the mouth of a cavern at the cliffs of Terion", "were a single child survivor of an incident in the Valley of the Unfortunate Undead.", "were dying of plague in a Bergen Chrypt hovel, you touched something from outside.", "were an average individual until you encountered something in a dim glade in Sarkash.", "were raised on a lonley island in Lake Onda. No one else has ever heard of this island and you can't return."
    ]
    var esoteric_hermit_abilities = [
      ["Wise", ""],
      ["Weak", ""]
    ]
    var esoteric_hermit_features = [
      ["Master of Fate", "What use are maps when the substance of casuality itself is open to you? You know the right way with a DR8 PRESENCE test."],
      ["Book of Boiling Blood", "You may open and read from this book once a day. Your enemy must make a DR12 test to prevent this. If they fail d2 Berserker-slayers(page 59) appear from the depths of a forgotten dimension of blood. Roll a d6. On a 1-4 these creatures fight alongside you. On a 5-6 they turn on you, attempting to kill you and destroy the book. After the battle they return to their imprisonment."],
      ["Speaker of Truths", "Twice per day use your wisdom, knowledge, advice and inner calm to bring clarity to a creature of your choice. The DR of the next test they undertake is lowered by 4."],
      ["Initiate of the Invisible College", "Once per day you may summon d2 scrolls, whose power can be used only once. Roll a d4, on a 1-2 the scrolls are sacred, on a 3-4, unclean. If the scrolls are not used before sunrise they turn to ash."],
      ["Bard of the Undying", "You learn your melodies in the Otherworld. The music of your Harp gives +d4 on reaction rolls."],
      ["Hawk as Weapon", "Your crafty almost-intelligent hawk is loyal only to you. Even without shared language, you understand its cries as it keeps watch, scouts and swoops to attack foes. (8 HP Attacks/Defence DR10 claws/bite d4 damage) "]
    ]
    var gutterborn_memory = ["you were dumped onto a moving shit-cart still in your birth caul.", "your mother hanged from a tree outside of Galgenbeck, you fell from the corpse", "you were raised by rats in the gutters of Grift.", "you were kicked and beaten beneath a baker’s table in Schleswig.", "you escaped the Tvelandian orphanarium.", "you were educated by outlaws in a hovel south of Alliáns."]
    var gutterborn_abilities = [
      ["Small", ""],
      ["Stealthy", "All PRESENCE and AGILITY tests have their DR reduced by 2 (normal tests are DR10 instead of DR12."]
    ]
    var gutterborn_features = [
      ["Coward's Jab", "When attacking by surprise test AGILITY DR10. On a success you automatically hit once with a light one-handed weapon, dealing normal damage +3."],
      ["Filthy Fingersmith", "Your snaky little digits get into pockets and pick locks with DR8 AGILITY test. You also begin with lockpicks!"],
      ["Abominable Gob Lobber", "Your phlegm is viscous, lumpy and vile and ballistically accurate at short range. You can spit d2 times during a fight. Roll a DR8 PRESENCE test for accuracy. Targets are blinded, retching and vomitting for d4 rounds. Anyone witnessing this-friend and foe- must make a TOUGHNESS test to not also vomit. PCs test DR10 and enemies DR12."],
      ["Escaping Stealth", "Every time you use an omen there is a 50% chance it is not spent."],
      ["Excretal Stealth", "You have an astounding almost, preternatural ability to hide in muck, debris and filth. When hidden in these conditions a DR16 PRESENCE test is required to notice you."],
      ["Dodgin Death", "You are so unpleasant, irrelevant, disgusting and vile even Death rather avoid you if it can. On Death, if there is even the slightest possibility that you survived, there is a 50% chance that you did. If successful, after 10 rounds you pop back up with d4 HP and an unlikely explanation of your escape."]
    ]
    var fanged_deserter_memory = ["a burnt-black building in Sarkash. Your home?", "a derelict rotting ship rolling endlessly across a grey sea.", "a brothel in Schleswig. Quite a friendly environment.", "sleeping with dogs in the corner of an inn, waiting for", "following an army in eastern Wästland.", "suckling a wolf in the wild of Bergen Chrypt."]
    var fanged_deserter_features =[
      ["Crumpled Monster Mask", "Strikes primitive fear into lesser creatures like golbins, gnoums and children. While worn they check Morale every round."],
      ["The Brown Scimitar of Galgenbeck", "A stinking sword you pulled from a military shit-ditch. d6 damage DR10 attack and defence while you wield it. 1-in-6 chance a wounded enemy is smitten with potent sepsis, dying in 10 minutes."],
      ["Wizard Teeth", "Four weird teeth rattle within a blackened pouch. Before battle roll a d6 for each one. For every 6 one of your attacks deals maximum damage."],
      ["Old Sigûrd's Sling", "Sigûrd was the strongest man whose thraot you ever gnawed. Woven from his long grey hair, this sling has never failed you. 2d5 damage, requires fist-sized rocks which, perhaps regrettably, are everywhere."],
      ["Ancient Gore-Hound", "Asthmatic, deluded and on its last legs, this wizened creature still has a superb nose and can sniffle up treasure in the most disgusting debris. Attack with DR10 (bite d6 damage). Defends with DR12, 10 HP. Becomes frenzied around goblins and berserkers."],
      ["The Shoe of Death's Horse", "It looks normal but since finding it in an obscure crypt you are convinced this show came from the horse of Death himself. In your hands it hits with DR10, d4 damage. 1-in-6 chance the shoe smashes the skull, instantly killing small-to-medium size creatures. The show returns to your hand link a boomerang."]
    ]
    var fanged_deserter_abilites = [
      ["Built Like a Bull", ""],
      ["Not a Bright Spark", "Normal AGILITY tests are DR14 instead of DR12, excluding defence."],
      ["Illiterate", "You are incapable of understanding scrolls. If you being with on then rerol, eat it or use it as tiolet paper."],
      ["Bite Attack", "DR10 to attack d6 damage. You must be close to your target. 1-2 on d6 chance the enemy gets a free attack."]
    ]
    var classes = ['Wretch', 'Fanged Deserter', 'Gutterborn Scum', 'Esoteric Hermit', 'Wretched Royalty', 'Heretical Priest', 'Occult Herbmaster'];
    var names = ["Aerg-Tval","Agn","Arvant","Belsum","Belum","Brinta","B\xf6rda","Daeru","Eldar","Felban","Gotven","Graft","Grin","Grittr","Haer\xfc","Hargha","Harmug","Jotna","Karg","Karva","Katla","Keftar","Klort","Kratar","Kutz","Kvetin","Lygan","Margar","Merkari","Nagl","Niduk","Nifehl","Pr\xfcgl","Qillnach","Risten","Svind","Theras","Therg","Torvul","T\xf6rn","Urm","Urvarg","Vagal","Vatan","Von","Vrakh","Vresi","Wemut"];
    var traits = ["Endlessly aggravated", "Inferiority complex", "Problems with authority", "Loud mouth", "Cruel", "Egocentric", "Nihilistic", "Prone to substance abuse", "Conflicted", "Shrewd", "Vindictive", "Cowardly", "Lazy", "Suspicious", "Ruthless", "Worried", "Bitter", "Deceitful", "Wasteful", "Arrogant"];
    var bodies = ["Staring manic gaze.", "Covered in (for some) blasphemous tattoos.", "Rotting face. Wears a mask.", "Lost three toes, limps.", "Starved: faunt and pale.", "One hand replaced with rusting hook (d6 damage).", "Decaying teeth.", "Hauntingly beautiful, unnervingly clean.", "Hands caked with sores.", "Cataracts slowly but surly spreading in both eyes.", "Long tangled hair, at least one cockroach in residence.", "Broken, crushed ears.", "Juddering and stuttering from nerve damage or stress.", "Corpulent, ravenous, drooling.", "One hand lacks thumb and index finger, grips like a lobster.", "Red, swollen alcoholic’s nose.", "Resting maniac face, making friends is hard.", "Chronic athlete’s foot. Stinks.", "Recently slashed and stinking eye covered with a patch.", "Nails cracked and black, maybe about to drop off."]
    var bad_habits = ["Obsessively collect small sharp stones.", "Won’t use a blade without testing it on your own flesh. Arms knitted with scars.", "Can’t stop drinking once you start.", "Gambling addict. Must bet every day. If you lose, raise and bet again.", "Cannot tolerate criticism of any kind. Results in rage and weeping.", "Unable to get to the point. Have never actually finished a story.", "Best friend is a skull. Carry it with you, tell it everything, you trust no one more.", "You pick your nose so deep it bleeds.", "Laugh hysterically at your own jokes which you then explain in detail.", "A nihilist. You insist on telling everyone you are a nihilist and explaining why.", "Inveterate bug eater.", "Stress response is aesthetic display. The worse things get the fancier you need to be.", "Permanent phlegm deposit in throat. Continuously cough, snort, spit and swallow.", "Pyromaniac.", "Consistently lose important items and forget vital facts.", "Insecure shit-stirrer. Will talk about whoever just left the room.", "You stutter when lying.", "You giggle insanely at the worst possible times.", "You whistle while trying to hide. You will deny this. Whistle when 5, 7, 9, 11 or 13 is rolled on a d20.", "You make jewelry from the teeth of the dead."]
    var tales = ["Pursued for manslaughter. There is a bounty.", "In massive debt. The debt is being traded to successively more ruthless groups.", "Have a rare, sought after item.", "Have a cursed never healing wound.", "Had an illegal, immoral and secret affair with a member of the royal family. Has proof.", "Escaped cult member. Terrified and paranoid. Other cultists are everywhere.", "An identity thief who recently killed and replaced this person.", "Banished and disowned for unspecified deeds. Can never go home.", "Deserted military after witnessing a massacre, bounty on head. Hunted by former friends.", "Very recently murdered a close relative. Very recently.", "A puzzle cube has been calibrated incorrectly (or has it?), awkening a slimbering abomination.", "Evil creatures love the scent of your spoor and are drawn to it, bringing disaster in your wake.", "A battle wound left a shard of metal slowly inching closer to your heart. Every day there is a 2% chance it reaches it.", "Violence forced you into the wilderness. You think waving trees are whispering. You talk to, scream at, attack trees.", "Cursed to share the nightmares of others, you sleep far, far away.", "At permanent war with all corvids. No contact without some violence. You carry a sling.", "After dreaming of an underground temple to a forgotten god you understand the songs of insects and worms.", "Being tracked and observed by a golem after an agreement which you know has been wiped form your mind.", "\'Burn or be burned\' is the fate you accept.", "Your flesh heals twice as fast, but your companions twice as slow. You see a many-eye \'guardian angel\'."]
    var unclean_scrolls = [
      ["Palms Open the Southern Gate (unclean scroll)", "A ball of fire hits d2 creatures dealing d8 damage per creature"],
      ["Tongue of Eris (unclean scroll)", "A creature of your choice is confused for 10 minutes"],
      ["Te-Le-Kin-Esis (unclean scroll)", "Move an object up to d10*10 feet for d6 minutes"],
      ["Lucy-Fires Levitation (unclean scroll)", "Hover for PRESENCE + d10 rounds"],
      ["Daemon of Capillaries (unclean scroll)", "One creature suffocates for d6 rounds, losing d4 HP per round"],
      ["Metzhuotl Blind Your Eye (unclean scroll)", "A creature becomes invisible for d6 rounds or until it is damaged, attacking/defending with DR6"],
      ["Foul Psychompomp (unclean scroll)", "Summon (d6): 1-3 d4 skeletons, 4-6 d4 zombies"],
      ["Eyelid Blinds the Mind (unclean scroll)", "d4 creatures fall asleep for one hour unless they succeed a DR14 test"],
      ["Death (unclean scroll)", "All Creatures within 30 fett lose a total of 4d10 HP"]
    ]
    var sacred_scrolls = [
      ["Grace of a Dead Saint (sacred scroll)", "d2 creatures regain d10 HP each"],
      ["Grace for a Sinner (sacred scroll)", "A creature of your choice gets +d6 on one roll (damage, tests, etc.)"],
      ["Whispers Pass the Gate (sacred scroll)", "Ask three questions to a deceased creature"],
      ["Aegis of Sorrow (sacred scroll)", "A creature of your choice gains 2d6 extra HP for 10 rounds"],
      ["Unmet Fate (sacred scroll)", "One creature, dead for no more than a week, is awakened with terrible memories"],
      ["Beastial Speech (sacred scroll)", "You may speak with animals for d20 minutes"],
      ["False Dawn/Night's Chariot (sacred scroll)", "Light or pitch black for 3d10 minutes"],
      ["Hermetic Step (sacred scroll)", "You find all traps in your path of 2d10 minutes"],
      ["Roskoe's Consuming Glare (sacred scroll)", "d4 creatures lose d8 each"],
      ["Enochian Syntax (sacred scroll)", "One creature blindly obeys a single command"]
    ]

    function removeSmallest(arr) {
        var min = Math.min(...arr);
        return arr.filter(e => e != min);
    }

    function load_char() {
      if (!window.location.hash) { fixed_rolls_only(); klass = fd(6) - 1; generate(); return; }

      var tag = window.location.hash.split('&');
      if (tag.length != 3) { return; }
      if (tag[1].length != 2) { return; }
      if (tag[2].length != 2) { return; }

      document.querySelectorAll('input[type=checkbox]')[tag[2][0]].checked = true;
      document.querySelectorAll('input[type=checkbox]')[tag[2][1]].checked = true;

      document.getElementById("character").style.display = "block";

      _seed = tag[0].slice(1,);
      fixed_rolls_only();
      klass = tag[1];
      selected = tag[2].split('');
      generate();
    }
    load_char();

    var total_checks = 0;
    var checkboxes = document.querySelectorAll('input[type=checkbox]');
    for(var i = 0, len = checkboxes.length; i < len; i++) {
      checkboxes[i].addEventListener('change', function() {
        if (this.checked) {
          total_checks += 1;
        } else {
          total_checks -= 1;
        }

        if (total_checks > 2) {
          alert("Stop fooling around vagrant, only select two!");
          checkboxes.forEach(e => e.checked = false);
          total_checks = 0;
        }
      })
    }

    document.getElementById("prompt").addEventListener('submit', function(e) {
      e.preventDefault();

      document.getElementById("character").style.display = "block";
      history.pushState("", document.title, window.location.pathname + window.location.search);

      reseed();
      generate();
    })

    document.getElementById("save").addEventListener('click', function() {
      alert("Share able link: " +
              window.location.pathname +
                window.location.search +
                  "#" +
                    [_seed, klass.padStart(2, '0'), selected.join('')].join('&'));
    })

    var buttons = document.querySelectorAll("#klass > button");
    for(var i = 0; i < buttons.length; i++) {
      buttons[i].addEventListener('click', function(e) {
        if (e.target.value != 0) { document.getElementById("prompt").style.display = "none"; }
        if (e.target.value == 0) { document.getElementById("prompt").style.display = "block"; }
        klass = e.target.value;
        reseed();
        generate();
      });
    }

    function generate() {
      document.getElementById("equipment").innerHTML = "";
      document.getElementById("description").innerHTML = "";
      document.getElementById("skills").innerHTML = "";
      if (klass == 0) { document.getElementById("prompt").style.display = "block"; }

      document.getElementById("class_name").innerHTML = classes[klass];
      document.getElementById("name").innerHTML = names[(fd(6) - 1)*8 + fd(8) - 1];
      selected = Array.from(document.querySelectorAll('input[type=checkbox]:checked')).map(e => e.value);

      var memory;
      if (klass == 0) {
        story = fd(tales.length);
        memory = tales[story - 1];
      } else if (klass == 1) {
        memory = "Your earliest memories are of " + frandom_item_from(fanged_deserter_memory);
      } else if (klass == 2) {
        memory = "As a child, " + frandom_item_from(gutterborn_memory);
      } else if (klass == 3) {
        memory = "You " + frandom_item_from(esoteric_hermit_memory);
      } else if (klass == 4) {
        memory = "Things were going so well, until " +frandom_item_from(wretched_royalty_memory);
      } else if (klass == 5) {
        memory = "You come from " + frandom_item_from(heretical_priest_memory);
      } else if (klass == 6) {
        memory = "From " + frandom_item_from(occult_herbmaster_memory);
      }
      var trait1 = frandom_item_from(traits);
      var trait2 = trait1;
      while (trait2 == trait1) {
        var trait2 = frandom_item_from(traits);
      }
      var habit = fd(bad_habits.length);
      var story;
      document.getElementById("description").innerHTML = "<p>" + descriptions[klass] + "</p>";
      document.getElementById("description").innerHTML += "<p>" + memory + "</p>";
      document.getElementById("description").innerHTML += [
        "<p>",
        trait1 + " and " + trait2 + '.',
        frandom_item_from(bodies),
        bad_habits[habit-1],
        "</p>"
      ].join(' ');

      var skills = [];
      var base_skills = [["Nimble", ""], ["Witty", ""], ["Well-fed", ""], ["Indomitable", ""]]
      if (klass == 0) {
        if (selected[0]) { skills.push(base_skills[selected[0]]); }
        if (selected[1]) { skills.push(base_skills[selected[1]]); }
      } else if (klass == 1) {
        skills = fanged_deserter_abilites;
        skills.push(frandom_item_from(fanged_deserter_features));
      } else if (klass == 2) {
        skills = gutterborn_abilities;
        skills.push(frandom_item_from(gutterborn_features));
      } else if (klass == 3) {
        skills = esoteric_hermit_abilities;
        skills.push(frandom_item_from(esoteric_hermit_features));
      } else if (klass == 4) {
        skills = wretched_royalty_abilities;
        var wr_skill1 = frandom_item_from(wretched_royalty_features);
        var wr_skill2;
        do {
          wr_skill2 = frandom_item_from(wretched_royalty_features);
        } while(wr_skill1 == wr_skill2);
        skills.push(wr_skill1);
        skills.push(wr_skill2);
      } else if (klass == 5) {
        skills = heretical_priest_abilities;
        skills.push(frandom_item_from(heretical_priest_features));
      } else if (klass == 6) {
        skills = occult_herbmaster_abilities;
      }
      for(var i = 0; i < skills.length; i++) {
        document.getElementById("skills").innerHTML += "<br><b>" + skills[i][0] + "</b>";
        if (skills[i][1] != '') {
          document.getElementById("skills").innerHTML += "<br>" + skills[i][1] + "<br>";
        }  else {
          document.getElementById("skills").innerHTML += "<br>"
        }
      }

      var abilities = [" -3", " -3", " -3", " -3", " -2", " -2", " -1", " -1", "±0", "±0", "±0", "±0", "+1", "+1", "+2", "+2", "+3", "+3", "+3", "+3"]
      var stats = []
      for(var i = 0; i < 4; i++) {
        if (klass == 0) {
          stats.push(selected.includes(i.toString()) ? removeSmallest([fd(6), fd(6), fd(6), fd(6)]).reduce((partialSum, a) => partialSum + a, 0) : fd(6) + fd(6) + fd(6))
        } else {
          stats.push(fd(6) + fd(6) + fd(6));
        }
      }
      if (klass == 1) {
        stats[0] -= 1;
        stats[1] -= 1;
        stats[2] += 2;
      } else if (klass == 2) {
        stats[2] -= 2;
      } else if (klass == 3 || klass == 5) {
        stats[1] += 2;
        stats[2] -= 2;
      } else if (klass == 6) {
        stats[2] -= 2;
        stats[3] += 2;
      }

      document.getElementById("agility").innerHTML = abilities[stats[0] - 1];
      document.getElementById("presence").innerHTML = abilities[stats[1] - 1];
      document.getElementById("strength").innerHTML = abilities[stats[2] - 1];
      document.getElementById("toughness").innerHTML = abilities[stats[3] - 1];

      var hp_mod;
      if (klass == 0 || klass == 5) {
        hp_mod = fd(8);
      } else if (klass == 1) {
        hp_mod = fd(10);
      } else if (klass == 2 || klass == 4 || klass == 6) {
        hp_mod = fd(6);
      } else if (klass == 3) {
        hp_mod = fd(4);
      }
      var hp = Math.max(1, (parseInt(abilities[stats[3]]) || 0) + hp_mod);
      document.getElementById("hp").innerHTML = hp + "/" + hp;

      var food = ["Waterskin", " and " + fd(4) + " days' worth of food"]
      var silver;
      if (klass == 0 || klass == 1 || klass == 6) {
        silver = (fd(6) + fd(6))*10;
      } else if (klass == 2 || klass == 3) {
        silver = fd(6)*10;
      } else if (klass == 4) {
        silver = (fd(6) + fd(6) + fd(6) + fd(6))*10;
      } else if (klass == 5) {
        silver = (fd(6) + fd(6) + fd(6))*10;
      }

      var weapons = [
        ["Femur", "d4 damage"],
        ["Staff", "d4 damage"],
        ["Shortsword", "d4 damage"],
        ["Knife", "d4 damage"],
        ["Warhammer", "d6 damage"],
        ["Sword", "d6 damage"],
        ["Bow", "d6 damage, with " + stats[1]+10 + " arrows"],
        ["Flail", "d8 damage"],
        ["Crossbow", "d8 damage, with" + stats[1]+10 + " bolts"],
        ["Zweihänder", "d10 damage"]
      ]

      var light = ["Fur", "Padded cloth", "Leather"];
      var medium = ["Scale", "Mail"];
      var heavy = ["Splint", "Plate"];
      var armor = [
        ["", ""],
        [frandom_item_from(light) + " armor", "-d2 damage, tier 1"],
        [frandom_item_from(medium) + " armor", "-d4 damage, tier 2, DR+2 on AGILITY tests including defence"],
        [frandom_item_from(heavy) + " armor", "-d6 damage, tier 3, DR+4 on AGILITY tests, defence is DR+2"],
      ]

      var equip1 = [
        ["", ""],
        ["", ""],
        ["Backpack", "for 7 normal-size items"],
        ["Sack", "for 10 normal-sized items"],
        ["Small wagon", ""],
        ["Donkey", ""]
      ]

      var equip2 = [
        ["Rope", "30 feet"],
        [stats[1] + 4 + " torches", ""],
        ["Lantern", "with oil for " + stats[1] + 6 + " hours"],
        ["Magnesium strip", ""],
        frandom_item_from(unclean_scrolls),
        ["Sharp needle", ""],
        ["Medicine chest", stats[1] + 4 + " uses (stops bleeding/infection and heals d6 HP)"],
        ["Metal file and lockpicks", ""],
        ["Bear trap", "PRESENCE DR14 to spot, d8 damage"],
        ["Bomb", "(sealed bottle, d10 damage)"],
        ["A bottle of red poison", fd(4) + " doses (TOUGHNESS DR12 or d10 damage)"],
        ["Silver crucifix", ""]
      ]

      var equip3 = [
        ["Life elixir", fd(4) + " doses (heals d6 HP and removes infection)"],
        frandom_item_from(sacred_scrolls),
        ["Small but vicious dog", "(" + fd(6) + 2 + " HP, bite d4, only obeys you)"],
        [fd(4) + " monkey(s) that ignore but love you", "(" + fd(4) + 2 + " HP, punch/bite d4)"],
        ["Exquisite perfume", "worth 25s"],
        ["Toolbox", "10 nails, tongs, hammer, small saw, drill"],
        ["Heavy chain", "15 feet"],
        ["Grappling hook", ""],
        ["Shield", "(-1 HP damage or have the shield break to ignore on attack)"],
        ["Crowbar", "(d4 damage)"],
        ["Lard", "(may function as 5 meals in a pinch)"],
        ["Tent", ""]
      ]

      var equip4 = [
        ["Blanket", ""],
        ["Firesteel", ""],
        ["Chewing tabacco", fd(4) + " doses"],
        ["A bottle of salt", ""],
        ["Wooden crucifix", ""],
        ["Manacles", ""],
        ["A bottle of black poison", fd(4) + " doses (TOUGHNESS DR14 or d6 damage + blind for one hour)"],
        [fd(4) + " moderately tame rat(s)", "(2 HP, bite d2, only obeys you)"],
        ["Mirror", "worth 15s"],
        ["Scissors", ""],
        ["Meat cleaver", "d4 damage"],
        ["Caltrops", "d4 damage + infection on 1-in-6"],
        ["Hammer", "d4 damage"],
        ["Noose", ""],
        [fd(4) + " pieces of chalk", ""]
      ]

      document.getElementById("equipment").innerHTML += "<li>" + food[0] + "<em class='smaller'>" + food[1] + "</em></li>";

      var e1 = frandom_item_from(equip1);
      var e2 = fd(12);
      var e3 = fd(12);
      var scroll = e2 == 5 || e3 == 2;
      e2 = equip2[e2 - 1];
      e3 = equip3[e3 - 1];

      var starting_weapon;
      if (story == 16) {
        starting_weapon = ["Sling", "d4 damage with an unlimited amount of stones"]
      } else {
        starting_weapon = scroll ? frandom_item_from(weapons.slice(0, 6)) : frandom_item_from(weapons);
      }
      document.getElementById("equipment").innerHTML += "<li>" + starting_weapon[0] + "<em class='smaller'>&nbsp;" + starting_weapon[1] + "</em></li>";

      var starting_armor = scroll ? frandom_item_from(armor.slice(0, 2)) : frandom_item_from(armor);
      if (starting_armor[0] != "") {
        document.getElementById("equipment").innerHTML += "<li>" + starting_armor[0] + "<em class='smaller'>&nbsp;" + starting_armor[1] + "</em></li>";
      }

      var special_item;
      if (habit == 1) {
        special_item = ["Sackcloth bag", "and " + (fd(20) + fd(20) + fd(20) + fd(20) + fd(20)) + " small sharp stones"]
      } else if (habit == 7) {
        special_item = ["Skull", "a trusted friend"]
      } else if (habit == 20) {
        special_item = ["String Necklace", "with " + (fd(10) + fd(10) + fd(10) + fd(10) + fd(10)) + " mismatched teeth"]
      }
      if (special_item) {
        document.getElementById("equipment").innerHTML += "<li>" + special_item[0] + "<em class='smaller'>&nbsp;" + special_item[1] + "</em></li>";
      }

      if (e1[0] != "") {
        document.getElementById("equipment").innerHTML += "<li>" + e1[0] + "<em class='smaller'>&nbsp;" + e1[1] + "</em></li>";
      }
      document.getElementById("equipment").innerHTML += "<li>" + e2[0] + "<em class='smaller'>&nbsp;" + e2[1] + "</em></li>";
      document.getElementById("equipment").innerHTML += "<li>" + e3[0] + "<em class='smaller'>&nbsp;" + e3[1] + "</em></li>";

      if (story == 20 || fd(100) <= 8) {
        let e4 = frandom_item_from(equip4);
        document.getElementById("equipment").innerHTML += "<li>" + e4[0] + "<em class='smaller'>&nbsp;" + e4[1] + "</em></li>";
      }

      document.getElementById("equipment").innerHTML += "<li>" + silver + " silver</li>";

      var omens;
      if (klass == 3 || klass == 5) {
        omens = [fd(4), 4];
      } else {
        omens = [fd(2), 2];
      }
      document.getElementById("omens").innerHTML = omens[0] + " (d" + omens[1] + ")";
    }
  </script>
</body>
</html>